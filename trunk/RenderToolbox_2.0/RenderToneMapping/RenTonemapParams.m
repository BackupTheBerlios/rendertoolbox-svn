function  [factor] = RenTonemapParams(inputImagePlanes,maxLum,clipLevelFactor,DOPLOT)% [factor] = RenTonemapParams(inputImagePlanes,maxLum,clipLevelFactor,[DOPLOT])%% Calculate tonemap parameters from desired maxLum and clipLevelFactor% and input image.%% Input image planes should be in XYZ, and maxLum is maximum available% Y value.%% 7/19/04   dhb, bx     More comments.% 8/16/04	dhb, bx		DOPLOT now an optional argument.if (nargin < 3 | isempty(clipLevelFactor))    clipLevelFactor = 8;endif (nargin < 4 | isempty(DOPLOT))	DOPLOT = 0;endxPlane = inputImagePlanes(:,:,1);yPlane = inputImagePlanes(:,:,2);zPlane = inputImagePlanes(:,:,3);% Find the scaling factor and applyclipLevel = clipLevelFactor*mean(yPlane(:));factor = maxLum/clipLevel;% Make a diagnostic plotif (DOPLOT)	figure; clf; hold on	hist(yPlane(:));	plot(clipLevel,0,'o','MarkerSize',8,'MarkerFaceColor','r');end