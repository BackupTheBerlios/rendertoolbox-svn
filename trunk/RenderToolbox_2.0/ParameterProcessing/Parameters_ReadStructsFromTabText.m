function theStructs = Parameters_ReadStructsFromTabText(filename)% theStructs = ReadStructsFromText(filename)%% Parameters_ReadStructsFromTabText functions like the PsychToolBox's% ReadStructsFromText, except allows for white space within a single field% in each record (i.e., there can be spaces within each field). It returns% all values as strings, regardless of whether they are numbers of strings% in the text file.%% 2/10/06 dpl wrote it. based on dhb's ReadStructsFromText%first part of this file taken directly fron ReadStructsFromText% Open the filefid = fopen(filename);if (fid == -1)	error(sprintf('Cannot open file %s',filename));end% Read first line to get field names for returned structuretheFields = {};firstLine = fgetl(fid);theIndex = 1;i = 1;while (1)	wholeField = [];	while (1)		readString = firstLine(theIndex:end);		[field,count,nil,nextIndex] = sscanf(readString,'%s',1);		if (count == 0)			break;		end		wholeField = [wholeField field];		theIndex = theIndex+nextIndex-1;		if (nextIndex <= length(readString) & abs(readString(nextIndex)) == 9)			break;		else			wholeField = [wholeField ' '];		end	end	if (count == 0)		if (~isempty(wholeField))			theFields{i} = wholeField;			i = i+1;		end		break;	end	theFields{i} = wholeField;	wholeField = [];	i = i+1;endnFields = length(theFields);% Squeeze white space out of each fieldfor i = 1:nFields	newField = [];	oldField = theFields{i};	for j = 1:length(oldField)		if (~isspace(oldField(j)) & oldField(j) ~= '.')			newField = [newField oldField(j)];		end	end	theFields{i} = newField;end%this part rewritten to divide the file be tab stops instead of white space%(space)%get values for each linecurrentLine=1;while(1)    theLine=fgetl(fid);    if (isempty(theLine) | theLine == -1)		break;    end	data = cell(nFields,1);        %find indices of tab stops    tabIndices=regexp(theLine,'\t');        %check to make sure we have the right number of tab stops, one after    %each field except the last    if length(tabIndices)~=nFields-1        error(['Data in file ' filename ' not properly formatted']);    end    %read first field, until the first tab stop    data{1}=theLine(1:tabIndices(1)-1);    %if there's only one field, skip the rest    if nFields==1        break;    end        %read middle fields    for currentField=2:(nFields-1)        startTab=tabIndices(currentField-1);        endTab=tabIndices(currentField);        data{currentField}=theLine(startTab+1:endTab-1);    end        %read last field    startTab=tabIndices(nFields-1);    data{nFields}=theLine(startTab+1:end);        %check which fields are numbers, and convert them from strings    for currentField=1:nFields        [field,count,nil,nextIndex]=sscanf(data{currentField},'%g',1);        if count~=0            data{currentField}=field;        end    end        %pack into struct for each     theStruct = cell2struct(data,theFields,1);	theStructs(currentLine) = theStruct;	currentLine=currentLine+1;     end% Close the file.fclose(fid);