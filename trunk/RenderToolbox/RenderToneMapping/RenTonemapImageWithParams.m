function  [outputImage] = RenTonemapImageWithParams(coneImage,T_xyz,T_cones,maxLum,factor)% [outputImage] = RenTonemapImageWithParams(theCamera,coneImage,T_cones,S_cones,maxLum,factor)%% Tonemap a cone image using maxLum and factor previously determined.%% 7/19/04   bx, dhb     Simplify.% % Load color matching functions.% whichXYZ = '1931';% eval(['load(''T_xyz' whichXYZ ''')';]);% eval(['T_xyzRaw = T_xyz' whichXYZ ';']);% eval(['S_xyzRaw = S_xyz' whichXYZ ';']);% % % Load information to convert LMS to XYZ% T_xyz = SplineCmf(S_xyzRaw,683*T_xyzRaw,theCamera.wavelengthSampling);M_ConesToXYZ = (T_cones'\T_xyz')';M_XYZToCones = inv(M_ConesToXYZ);% Tonemap the XYZ imagesXYZImage = SimApplyColorTransform(M_ConesToXYZ,coneImage.images);XYZImage = RenBasicToneMapWithParams(XYZImage,maxLum,factor);outputImage = SimApplyColorTransform(M_XYZToCones,XYZImage);